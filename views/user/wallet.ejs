<%-include('../layouts/userHeader') %>


	<!-- Title page -->
	<section class="bg-img1 txt-center p-lr-15 p-tb-80" style="background-image: url('images/bg-01.jpg');">
		<h2 class="ltext-105 cl0 txt-center">
			Wallet
		</h2>
	</section>


<div class="">
    <section class="h-100 bg0 p-t-104" >
        <div class="container py-5 h-100" >
          <button type="button" class="btn btn-primary" data-mdb-toggle="modal" data-mdb-target="#exampleModal" data-mdb-whatever="@getbootstrap" >
            Add Amount
          </button>
          <div class="row d-flex justify-content-center align-items-center h-100 py-5" style="justify-content: center; display: flex; ">
            <div class="col-lg-10 col-xl-8" >
            <div class="bg-light p-20">
                <div class="d-flex">
                    <div class="align-self-center">
                        <h3 class="m-b-0">WALLET</h3></div>
                    <div class="ml-auto align-self-center">
                        <h2 class="text-success">$<%= parseFloat(wallet.wallet_amount).toFixed(2) %></h2></div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover earning-box w-100" >
                        <thead>
                            <tr style="justify-content: space-between; display: flex;">
                                <th ><h5>Transfer Amount</h5></th>
                                <th><h5>Transaction ID</h5></th>
                            </tr>
                        </thead>
                        <tbody>

                            <!-- <tr>
                                <td style="width:50px;"><span class="round"><img src="https://i.imgur.com/uIgDDDd.jpg" alt="user" width="50"></span></td>
                                <td>
                                    <h6>Samso Nagaro</h6><small class="text-muted">Web Designer</small></td>
                                <td><span class="label label-success">High</span></td>
                                <td>$3.9K</td>
                            </tr> -->
                            <% if (wallet.wallet_history && wallet.wallet_history.length > 0) { %>
                                <% for (let i = 0; i < wallet.wallet_history.length; i++) { %>
                                  <% const wallet_history = wallet.wallet_history[i]; %>
                                  <tr class="w-100" style="justify-content: space-between; display: flex;">
                                    <input type="hidden" value="<%= wallet_history.transaction_amount %>">
                                    <td><h4><%= wallet_history.transaction_amount %></h4></td>
                                    <td><h4><%= wallet_history._id %></h4></td>
                                  </tr>
                                <% } %>
                              <% } else { %>
                                <tr>
                                  <td colspan="2">No transactions found</td>
                                </tr>
                              <% } %>
                                                       
                           
                        </tbody>
                    </table>
                </div>
            </div>
            </div>
          </div>
        </div>
      </section>


      <div class="modal fade" id="exampleModal" tabindex="1200" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="" id="exampleModalLabel">Edit Status</h5>
              <button type="button" class="btn-close" data-mdb-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form class="pay-form">
                <div class="mb-3">
                    <!-- <input type="hidden" name="productID" id="productIDInput"> -->
                  <label class="col-form-label">Amount:</label>
                  <input type="number" name="addamount">
                </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary" data-mdb-dismiss="modal">Submit</button>
            </div>
            </form>
          </div>
        </div>
      </div>
    </div>


</div>
  <%-include('../layouts/userFooter') %>

  <!-- Back to top -->
	<div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
	</div>

<!--===============================================================================================-->	
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
<!--===============================================================================================-->
	<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>
<!--===============================================================================================-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKFWBqlKAGCeS1rMVoaNlwyayu0e0YRes"></script>
	<script src="js/map-custom.js"></script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>

  
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.1/mdb.min.js"></script>
  <script>
    const exampleModal = document.getElementById('exampleModal');
    exampleModal.addEventListener('show.bs.modal', (event) => {
    // Button that triggered the modal
    const button = event.relatedTarget;
    // Extract info from data-mdb-* attributes
    const recipient = button.getAttribute('data-mdb-whatever');
    // If necessary, you could initiate an AJAX request here
    // and then do the updating in a callback.
    // const productId = button.getAttribute('data-product-id');

    // const productIDInput = exampleModal.querySelector('#productIDInput');
    //     productIDInput.value = productId
    //
    // Update the modal's content.
    const modalTitle = exampleModal.querySelector('.modal-title');
    const modalBodyInput = exampleModal.querySelector('.modal-body input');

    modalTitle.textContent = `New message to ${recipient}`;
    modalBodyInput.value = recipient;
    });

</script>


<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>

  $(document).ready(function(){
    $('.pay-form').submit(function(e){
      e.preventDefault();
  
      var formData = $(this).serialize();
  
      $.ajax({
        url:"/wallet",
        type:"POST",
        data: formData,
        success:function(res){
          if(res.success){
              var options = {
              "key": ""+res.key_id+"",
              "amount": ""+res.amount+"",
              "currency": "USD",
              "name": "Payment",
              "image": "https://dummyimage.com/600x400/000/fff",
              "handler": function (response){
                window.location.href = "/wallet"
                alert("Payment Succeeded");
                // window.open("/","_self")
              },
              "prefill": {
                "contact":9895299091,
                "name": ""+res.name+"",
                "email": ""+res.email+""
              },
              "theme": {
                "color": "#2300a3"
              }
            };
            var razorpayObject = new Razorpay(options);
            razorpayObject.on('payment.failed', function (response){
                alert("Payment Failed");
            });
            razorpayObject.open();
          }
          else{
            alert(res.msg);
          }
        }
      })
  
    });
  });
  
  </script>


</body>
</html>