<%-include('../layouts/userHeader') %>

	<!-- Title page -->
	<section class="bg-img1 txt-center p-lr-15 p-tb-80" style="background-image: url('images/bg-01.jpg');">
		<h2 class="ltext-105 cl0 txt-center">
			Order Details
		</h2>
	</section>


<div class="">
    <section class="h-100 bg0 p-t-104" >
        <div class="container py-5 h-100">
          <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-10 col-xl-8">
              <div class="card" style="border-radius: 10px;">
                <div class="card-header px-4 py-5">
                  <h5 class="mb-0"><%= order.product_name %></h5>
                </div>
                <div class="card-body p-4">
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <p class="lead fw-normal mb-0" style="color: #000000;">ORDERED</p>
                    <p class="small text-muted mb-0" style="text-transform: uppercase;">Receipt ID : <%= order._id %></p>
                  </div>
                  <div class="card shadow-0 border mb-4">
                      <div class="card-body">
                        <div class="row" style="display: flex; justify-content: space-between; align-items: center;">
                          <div class="col-md-2">
                            <img src="/admin/images/<%= order.product_img %>"
                              class="img-fluid" alt="Phone">
                          </div>
                          <div class="col-md-3">
                            <button id="invoicedownload">Download Invoice</button>
                          </div>
                        </div>
                        <% let total %>
                        <input type="hidden" name="total" value="<%= total += parseFloat(order.product_price) * parseFloat(order.product_quantity) %>">
								        <input type="hidden" name="prid" value="<%= prid = order.user_id %>">
                        <hr class="mb-4" style="background-color: #e0e0e0; opacity: 1;">
                        <div class="row d-flex align-items-center m-tb-10" style="display: flex; justify-content: space-between;">
                            <div class="col-md-3">
                                <p class="mb-0">Brand: </p>
                                <p class="mt-1 mb-0 ms-xl-5" style="text-transform: uppercase;"><%= order.product_brand %></p>
                            </div>
                        </div>
                        <div class="row d-flex align-items-center m-tb-10" style="display: flex; justify-content: space-between;">
                            <div class="col-md-3">
                                <p class="mb-0">Size: </p>
                                <p class="mt-1 mb-0 ms-xl-5 text-danger" style="text-transform: capitalize;"><%= order.product_size %></p>
                            </div>
                        </div>
                        <div class="row d-flex align-items-center m-tb-10" style="display: flex; justify-content: space-between;">
                            <div class="col-md-3">
                                <p class="mb-0">Qty: </p>
                                <p class="mt-1 mb-0 ms-xl-5 text-danger" style="text-transform: capitalize;"><%= order.product_quantity %></p>
                              </div>
                        </div>
                        <div class="row d-flex align-items-center m-t-30" style="display: flex; justify-content: space-between;">
                          <div class="col-md-3">
                            <p class="mb-0">Order Status:</p>
                            <p class="mt-1 mb-0 ms-xl-5 text-danger" style="text-transform: capitalize;"><%= order.product_status %></p>
                          </div>
                          <div class="d-flex justify-content-around mb-1">
                            
                          </div>
                          <div class="col-md-3">
                            <div class="d-flex justify-content-around mb-1 ">
                              <a href="/return?orderid=<%= order._id %>&&orderdate=<%= order.order_date %>">Return Product</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
      
                  <div class="d-flex justify-content-between mb-5">
                    <p class="text-muted mb-0" style="text-transform: uppercase;">Recepits Voucher : <%= order._id %></p>
                    <p class="text-muted mb-0"><span class="fw-bold me-4">Delivery Charges</span> Free</p>
                  </div>
                </div>
                <div class="card-footer border-0 px-4 py-5"
                  style="background-color: #000000; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
                  <h5 class="d-flex align-items-center justify-content-end text-white text-uppercase mb-0">Total 
                    paid  : <span class="h2 mb-0 m-l-15">  $<%= order.product_price %></span></h5>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
</div>
  <%-include('../layouts/userFooter') %>

  <!-- Back to top -->
	<div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
	</div>

<!--===============================================================================================-->	
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
<!--===============================================================================================-->
	<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>
<!--===============================================================================================-->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKFWBqlKAGCeS1rMVoaNlwyayu0e0YRes"></script>
	<script src="js/map-custom.js"></script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/alertifyjs/build/alertify.min.js"></script>
    <script>
        $(document).on('click', '#invoicedownload', function(e) {
          e.preventDefault();
          console.log('sadsfgdhf');
          $.ajax({
            method: "POST",
            url: "/downloadinvoice",
            dataType: 'json',
            data: {
              name: "<%= order.product_name %>",
              description: "<%= order.product_brand %>",
              unit: "pack",
              quantity: '<%= order.product_quantity %>',
              price: '<%= order.product_price %>',
              imgurl: "<%= order.product_img %>",
              username: "<%= user.name %>",
              mob: "<%= user.mobile %>",
              email: "<%= user.email %>",
              date: "<%= order.order_date %>",
              id: "<%= order._id %>",
              amount:"<%= order.amount %>"
            },
            success: function(response) {
              console.log(response);
              alertify.success(response.status);
              var timestamp = new Date().getTime();
              var filepath = response.filepath;
              // Create a temporary download link
              var downloadLink = document.createElement('a');
              downloadLink.href = URL.createObjectURL(response);
              downloadLink.download = 'invoice.pdf';
              downloadLink.style.display = 'none';
              document.body.appendChild(downloadLink);
              downloadLink.click();
              document.body.removeChild(downloadLink);

              var redirectUrl = "/download?path=" + encodeURIComponent(filepath);
            window.location.href = redirectUrl;
            },
            error: function(error) {
              console.log(error);
              alertify.error('Error occurred while updating quantity');
            }
          });
        });
        </script>
        

</body>
</html>